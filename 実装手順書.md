# Claude Code Slack Bot å®Ÿè£…æ‰‹é †æ›¸

## äº‹å‰æº–å‚™ï¼ˆã‚ãªãŸãŒè¡Œã†ä½œæ¥­ï¼‰

### 1. Slack Appä½œæˆæ‰‹é †

#### 1.1 Slack Appã®æ–°è¦ä½œæˆ
1. https://api.slack.com/apps ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒCreate New Appã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒFrom scratchã€ã‚’é¸æŠž
4. App Name: `Claude Code Bot`ï¼ˆä»»æ„ã®åå‰ï¼‰
5. Pick a workspace: ã‚ãªãŸã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’é¸æŠž
6. ã€ŒCreate Appã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### 1.2 Socket Modeã®æœ‰åŠ¹åŒ–
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒSocket Modeã€ã‚’é¸æŠž
2. ã€ŒEnable Socket Modeã€ã‚’ONã«ã™ã‚‹
3. Token Name: `socket-token`ï¼ˆä»»æ„ï¼‰ã‚’å…¥åŠ›
4. ã€ŒGenerateã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. **ç”Ÿæˆã•ã‚ŒãŸApp-Level Tokenï¼ˆxapp-...ï¼‰ã‚’ãƒ¡ãƒ¢** ðŸ“

#### 1.3 Bot Token Scopesã®è¨­å®š
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒOAuth & Permissionsã€ã‚’é¸æŠž
2. ã€ŒScopesã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã€ŒBot Token Scopesã€ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - `app_mentions:read`
   - `chat:write`
   - `commands`
   - `files:write`

#### 1.4 Slash Commandsã®è¨­å®š
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒSlash Commandsã€ã‚’é¸æŠž
2. ã€ŒCreate New Commandã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’é †ç•ªã«ä½œæˆï¼š

| Command | Request URL | Short Description | Usage Hint |
|---------|-------------|-------------------|------------|
| `/claude` | http://localhost:3000/slack/commands | Claude Codeæ“ä½œ | start, prompt, status, restart, end |

#### 1.5 Event Subscriptionsã®è¨­å®š
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒEvent Subscriptionsã€ã‚’é¸æŠž
2. ã€ŒEnable Eventsã€ã‚’ONã«ã™ã‚‹
3. ã€ŒSubscribe to bot eventsã€ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - `app_mention`
4. ã€ŒSave Changesã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### 1.6 App Installã¨ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒInstall Appã€ã‚’é¸æŠž
2. ã€ŒInstall to Workspaceã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æ¨©é™ã‚’ç¢ºèªã—ã¦ã€Œè¨±å¯ã™ã‚‹ã€
4. **Bot User OAuth Tokenï¼ˆxoxb-...ï¼‰ã‚’ãƒ¡ãƒ¢** ðŸ“

#### 1.7 Basic Informationã‹ã‚‰æƒ…å ±å–å¾—
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒBasic Informationã€ã‚’é¸æŠž
2. ã€ŒApp Credentialsã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ä»¥ä¸‹ã‚’ãƒ¡ãƒ¢ï¼š
   - **Signing Secret** ðŸ“

### 2. ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

WSL2ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```bash
cd /home/monkey999/develop/claudecode-slack

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .env << EOF
# Slackè¨­å®šï¼ˆä¸Šè¨˜ã§ãƒ¡ãƒ¢ã—ãŸå€¤ã‚’å…¥åŠ›ï¼‰
SLACK_BOT_TOKEN=xoxb-YOUR-BOT-TOKEN
SLACK_APP_TOKEN=xapp-YOUR-APP-TOKEN
SLACK_SIGNING_SECRET=YOUR-SIGNING-SECRET

# Claude Codeè¨­å®š
CLAUDE_CODE_PATH=/usr/local/bin/claude

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
SESSION_TIMEOUT_MINUTES=30
MAX_OUTPUT_LENGTH=40000
EOF
```

### 3. Node.jsç’°å¢ƒã®æº–å‚™

```bash
# Node.jsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
node --version
npm --version

# ã‚‚ã—Node.jsãŒãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
# sudo apt-get install -y nodejs
```

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# package.jsonã‚’ä½œæˆ
npm init -y

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install @slack/bolt dotenv
npm install --save-dev @types/node typescript ts-node nodemon

# TypeScriptè¨­å®šã‚’åˆæœŸåŒ–
npx tsc --init
```

### 5. TypeScriptè¨­å®šã®æ›´æ–°

`tsconfig.json`ã‚’ä»¥ä¸‹ã®å†…å®¹ã«æ›´æ–°ï¼š

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### 6. package.jsonã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ 

`package.json`ã®`scripts`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä»¥ä¸‹ã«æ›´æ–°ï¼š

```json
{
  "scripts": {
    "dev": "nodemon --exec ts-node src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "typecheck": "tsc --noEmit"
  }
}
```

### 7. Gitignoreã®è¨­å®š

```bash
cat > .gitignore << EOF
node_modules/
dist/
.env
*.log
.DS_Store
EOF
```

## å®Ÿè£…é–‹å§‹ã®ç¢ºèªäº‹é …

ä»¥ä¸‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] Slack AppãŒä½œæˆã•ã‚Œã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] 3ã¤ã®ãƒˆãƒ¼ã‚¯ãƒ³/ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã—ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã—ãŸ
- [ ] Node.jsã¨npmãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] å¿…è¦ãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ
- [ ] TypeScriptã®è¨­å®šãŒå®Œäº†ã—ãŸ

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ä¸Šè¨˜ã®æº–å‚™ãŒå®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®é †ç•ªã§å®Ÿè£…ã‚’é€²ã‚ã¾ã™ï¼š

1. **åŸºæœ¬çš„ãªSlack Botã®å®Ÿè£…**
   - `src/index.ts`: ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
   - `src/slack/app.ts`: Slack AppåˆæœŸåŒ–

2. **ã‚³ãƒžãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…**
   - `src/slack/commands.ts`: Slashã‚³ãƒžãƒ³ãƒ‰å‡¦ç†

3. **Claude Codeé€£æºã®å®Ÿè£…**
   - `src/claude/executor.ts`: Claude Codeå®Ÿè¡Œ
   - `src/claude/session.ts`: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

4. **ãƒ†ã‚¹ãƒˆã¨å‹•ä½œç¢ºèª**
   - `npm run dev`ã§èµ·å‹•
   - Slackã‹ã‚‰å„ã‚³ãƒžãƒ³ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ

æº–å‚™ãŒã§ããŸã‚‰ã€Œæº–å‚™å®Œäº†ã€ã¨æ•™ãˆã¦ãã ã•ã„ã€‚å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã€‚